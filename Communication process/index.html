<!--- this script embed an animation to show the process of communication-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Animated Communication Process</title>
<style>
  :root{
    --bg:#0f1115;
    --panel:#161a22;
    --text:#e9efff;
    --muted:#a8b3cf;
    --encode:#3ddc84;   /* green */
    --decode:#e05a5a;   /* red   */
    --message:#3aa7ff;  /* blue  */
    --accent:#ffc857;   /* yellow */
  }
  /* Reset */
  *,*::before,*::after{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:var(--bg);
    color:var(--text);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:12px;
  }
  .app{
    width:min(1100px,98vw);
    background:var(--panel);
    border:1px solid #273043;
    border-radius:18px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
    padding:14px 16px 12px;
  }

  header{
    display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between;
    margin-bottom:8px
  }
  header h1{
    font-size:18px;margin:0;color:var(--text);font-weight:700;letter-spacing:.2px
  }
  .controls{
    display:flex;align-items:center;gap:8px;flex-wrap:wrap
  }
  .controls button{
    background:#222a35;color:var(--text);border:1px solid #2e3a4f;border-radius:12px;
    padding:8px 12px;cursor:pointer;font-weight:600;min-width:82px
  }
  .controls button:disabled{opacity:.6;cursor:not-allowed}
  .controls .group{display:flex;align-items:center;gap:6px;background:#1a2130;border:1px solid #2a3346;border-radius:12px;padding:6px 8px}
  .controls label{font-size:13px;color:var(--muted)}
  .controls input[type="text"]{
    background:#0f141d;border:1px solid #283044;color:var(--text);
    border-radius:10px;padding:6px 8px;min-width:180px
  }
  .note{font-size:12px;color:var(--muted);margin-top:6px}

  /* Stage caption */
  .caption{
    text-align:center;margin:8px 0 6px 0;height:22px;color:var(--muted);font-weight:600;letter-spacing:.3px
  }

  /* Canvas container */
  .stage{
    background:#0c1017;border:1px solid #283044;border-radius:16px;padding:10px;position:relative
  }

  /* Legend */
  .legend{
    position:absolute;inset:auto 10px 10px auto;background:#121827;border:1px solid #2a3346;border-radius:10px;
    padding:6px 8px;font-size:12px;color:var(--muted)
  }
  .legend .dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;vertical-align:middle}
  .legend .row{white-space:nowrap}

  /* SVG text labels */
  .label{font: 600 14px/1 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;fill:#fff}
  .label.sub{font: 600 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;fill:#e7eefc;opacity:.85}
  .ghost{opacity:.12}

  /* Emphasis glows */
  .glow-encode{filter:drop-shadow(0 0 6px var(--encode)) drop-shadow(0 0 14px rgba(61,220,132,.45))}
  .glow-decode{filter:drop-shadow(0 0 6px var(--decode)) drop-shadow(0 0 14px rgba(224,90,90,.45))}
  .glow-message{filter:drop-shadow(0 0 6px var(--message)) drop-shadow(0 0 16px rgba(58,167,255,.5))}

  /* Message bubble */
  .bubble{paint-order:stroke;stroke:#5b8fd1;stroke-width:2;fill:rgba(58,167,255,.18)}
  .bubbleText{font:700 18px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;fill:#dff0ff}

  /* Arrow drawing via dash animation (JS controls timing) */
  .arrow{fill:none;stroke-width:6;stroke-linecap:round;stroke-linejoin:round}
  .encodeArrow{stroke:var(--encode)}
  .decodeArrow{stroke:var(--decode)}

  /* Noise squiggles */
  .noise path{stroke:var(--accent);stroke-width:3;fill:none;opacity:0}

  /* Progress bar */
  .progress{
    height:6px;background:#1b2433;border:1px solid #2a3346;border-radius:8px;margin-top:10px;overflow:hidden
  }
  .progress > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--encode),var(--message),var(--decode))}
  /* Accessibility helpers */
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
<div class="app" role="application" aria-label="Animated Communication Model">
  <header>
    <h1>Communication Process: Encoding → Message → Decoding</h1>
    <div class="controls" aria-label="Controls">
      <button id="playBtn" aria-label="Play">Play</button>
      <button id="pauseBtn" aria-label="Pause" disabled>Pause</button>
      <button id="restartBtn" aria-label="Restart">Restart</button>

      <div class="group" aria-label="Speed">
        <label for="speed">Speed</label>
        <input id="speed" type="range" min="0.5" max="2" step="0.1" value="1" />
        <span id="speedVal" aria-live="polite">1×</span>
      </div>

      <div class="group" aria-label="Message text">
        <label for="msgInput">Message</label>
        <input id="msgInput" type="text" value="Hello" maxlength="24" />
      </div>

      <div class="group" aria-label="Noise toggle">
        <label for="noiseToggle">Noise</label>
        <input id="noiseToggle" type="checkbox" />
      </div>
    </div>
  </header>

  <div class="caption" id="caption" aria-live="polite">Ready.</div>

  <div class="stage">
    <!-- Legend -->
    <div class="legend" aria-hidden="true">
      <div class="row"><span class="dot" style="background:var(--encode)"></span>Encoding</div>
      <div class="row"><span class="dot" style="background:var(--message)"></span>Message</div>
      <div class="row"><span class="dot" style="background:var(--decode)"></span>Decoding</div>
    </div>

    <!-- Scalable graphic -->
    <svg id="scene" viewBox="0 0 1100 360" width="100%" height="auto" role="img" aria-labelledby="title desc">
      <title id="title">Animated model of communication</title>
      <desc id="desc">A sender encodes a message, the message travels across a channel to a receiver who decodes it.</desc>

      <!-- Sender (left) -->
      <g id="sender" transform="translate(90,70)" class="ghost">
        <rect x="-40" y="210" width="175" height="60" rx="12" ry="12" fill="#111824" stroke="#29354b"/>
        <text class="label" x="48" y="-10" text-anchor="middle" fill="white">Sender</text>
        <!-- stick person -->
        <circle cx="48" cy="30" r="18" fill="#222" stroke="#4b5a77"/>
        <rect x="38" y="48" width="20" height="60" rx="8" fill="#222" stroke="#4b5a77"/>
        <rect x="28" y="110" width="14" height="56" rx="7" fill="#222" stroke="#4b5a77"/>
        <rect x="54" y="110" width="14" height="56" rx="7" fill="#222" stroke="#4b5a77"/>
        <rect x="18" y="60" width="16" height="40" rx="8" fill="#222" stroke="#4b5a77"/>
        <rect x="62" y="60" width="16" height="40" rx="8" fill="#222" stroke="#4b5a77"/>
        <text class="label sub" x="48" y="238" text-anchor="middle">Encoding</text>
      </g>

      <!-- Receiver (right) -->
      <g id="receiver" transform="translate(930,70)" class="ghost">
        <rect x="-40" y="210" width="175" height="60" rx="12" ry="12" fill="#111824" stroke="#29354b"/>
        <text class="label" x="48" y="-10" text-anchor="middle">Receiver</text>
        <!-- stick person -->
        <circle cx="48" cy="30" r="18" fill="#222" stroke="#4b5a77"/>
        <rect x="38" y="48" width="20" height="60" rx="8" fill="#222" stroke="#4b5a77"/>
        <rect x="28" y="110" width="14" height="56" rx="7" fill="#222" stroke="#4b5a77"/>
        <rect x="54" y="110" width="14" height="56" rx="7" fill="#222" stroke="#4b5a77"/>
        <rect x="18" y="60" width="16" height="40" rx="8" fill="#222" stroke="#4b5a77"/>
        <rect x="62" y="60" width="16" height="40" rx="8" fill="#222" stroke="#4b5a77"/>
        <text class="label sub" x="48" y="238" text-anchor="middle">Decoding</text>
      </g>

      <!-- Message bubble (center) -->
      <g id="bubbleGroup" transform="translate(390,110)" opacity="0">
        <ellipse id="bubble" class="bubble" cx="160" cy="68" rx="170" ry="70"></ellipse>
        <text id="bubbleText" class="bubbleText" x="160" y="75" text-anchor="middle">Hello</text>
      </g>

      <!-- Arrows -->
      <path id="encodeArrow" class="arrow encodeArrow"
            d="M 215 140 C 330 130, 420 120, 540 120"
            stroke-dasharray="1 1"/>
      <path id="decodeArrow" class="arrow decodeArrow"
            d="M 730 120 C 850 120, 940 130, 985 140"
            stroke-dasharray="1 1"/>

      <!-- Labels near arrows -->
      <text id="encodeLabel" class="label" x="360" y="95" text-anchor="middle" opacity="0">Encoding</text>
      <text id="decodeLabel" class="label" x="855" y="95" text-anchor="middle" opacity="0">Decoding</text>

      <!-- Noise squiggles in the channel -->
      <g id="noise" class="noise" transform="translate(540,70)">
        <path d="M 20 65 Q 40 30, 60 65 T 100 65 T 140 65"/>
        <path d="M 10 95 q 15 -20 30 0 t 30 0 t 30 0"/>
        <path d="M 30 45 q 20 -25 40 10 t 40 10 t 40 10"/>
      </g>

      <!-- Check mark at the end -->
      <g id="check" transform="translate(1000,210)" opacity="0">
        <circle r="20" cx="0" cy="0" fill="#16381f" stroke="#2b8540"/>
        <path d="M -8 0 l 6 7 l 12 -16" fill="none" stroke="#3ddc84" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      </g>
    </svg>
    <div class="progress" aria-hidden="true"><span id="bar"></span></div>
  </div>

  <p class="note">
    Tip: toggle Noise to show interference in the channel. Works in one file (no external libraries) and is Canvas‑friendly.
  </p>
</div>

<script>
/* ====== Utility ====== */
const $ = (sel) => document.querySelector(sel);
const encodeArrow = $("#encodeArrow");
const decodeArrow = $("#decodeArrow");
const encodeLabel = $("#encodeLabel");
const decodeLabel = $("#decodeLabel");
const sender = $("#sender");
const receiver = $("#receiver");
const bubbleGroup = $("#bubbleGroup");
const bubbleText = $("#bubbleText");
const noise = $("#noise");
const check = $("#check");
const caption = $("#caption");
const bar = $("#bar");

const playBtn = $("#playBtn");
const pauseBtn = $("#pauseBtn");
const restartBtn = $("#restartBtn");
const speed = $("#speed");
const speedVal = $("#speedVal");
const msgInput = $("#msgInput");
const noiseToggle = $("#noiseToggle");

let playing = false;
let raf = null;
let t0 = 0;          // timeline start (ms, monotonic)
let hold = 0;        // accumulated pause offset
let speedMul = 1;

/* ====== Path prep for "draw-on" effect ====== */
function prepPath(path){
  const len = path.getTotalLength();
  path.style.strokeDasharray = len + " " + len;
  path.style.strokeDashoffset = len;
  return len;
}
const encodeLen = prepPath(encodeArrow);
const decodeLen = prepPath(decodeArrow);

/* ====== Timeline (durations in milliseconds) ======
   We model 5 segments. The speed slider scales all durations. */
const segments = {
  highlightSender:  900,
  drawEncode:      1100,
  revealMessage:    900,
  drawDecode:      1100,
  highlightReceiver:900
};
const totalBase = Object.values(segments).reduce((a,b)=>a+b,0);

/* Convert timeline time (ms) to progress [0..1] */
function progress(now){
  const elapsed = (now - t0 - hold) * speedMul;
  return Math.min(1, Math.max(0, elapsed / totalBase));
}

/* ====== Rendering per frame ====== */
function render(p){
  // p in [0..1], map into cumulative segments
  const s = segments;
  const cut1 = s.highlightSender / totalBase;
  const cut2 = (s.highlightSender + s.drawEncode) / totalBase;
  const cut3 = (s.highlightSender + s.drawEncode + s.revealMessage) / totalBase;
  const cut4 = (s.highlightSender + s.drawEncode + s.revealMessage + s.drawDecode) / totalBase;

  // Reset visuals
  sender.classList.add("ghost");
  receiver.classList.add("ghost");
  encodeLabel.style.opacity = 0;
  decodeLabel.style.opacity = 0;
  noise.querySelectorAll("path").forEach(p=>p.style.opacity = 0);
  check.style.opacity = 0;

  // 1) Highlight Sender (Encoding begins)
  if(p <= cut1){
    const k = p / cut1;
    sender.classList.remove("ghost");
    sender.classList.add("glow-encode");
    caption.textContent = "Sender: Encoding the message…";
    encodeArrow.style.strokeDashoffset = encodeLen;
    bubbleGroup.style.opacity = 0;
  }

  // 2) Draw encode arrow
  if(p > cut1 && p <= cut2){
    caption.textContent = "Encoding → sending through the channel…";
    sender.classList.remove("ghost");
    sender.classList.add("glow-encode");
    encodeLabel.style.opacity = 1;
    const k = (p - cut1) / (cut2 - cut1);
    encodeArrow.style.strokeDashoffset = (1 - k) * encodeLen;
    bubbleGroup.style.opacity = 0;
  }

  // 3) Reveal message bubble (in the channel)
  if(p > cut2 && p <= cut3){
    caption.textContent = "Message in the channel.";
    sender.classList.remove("glow-encode");
    encodeArrow.style.strokeDashoffset = 0;
    bubbleGroup.style.opacity = 1;
    bubbleGroup.classList.add("glow-message");
    encodeLabel.style.opacity = 1;

    // Optional Noise
    if(noiseToggle.checked){
      const nk = (p - cut2) / (cut3 - cut2);
      noise.querySelectorAll("path").forEach((path,i)=>{
        path.style.opacity = 0.25 + 0.5*Math.sin((nk*6 + i)*Math.PI);
      });
      caption.textContent = "Message in the channel (with noise).";
    }
  }

  // 4) Draw decode arrow
  if(p > cut3 && p <= cut4){
    caption.textContent = "Channel → Receiver: Decoding…";
    const k = (p - cut3) / (cut4 - cut3);
    bubbleGroup.style.opacity = 1;
    decodeLabel.style.opacity = 1;
    decodeArrow.style.strokeDashoffset = (1 - k) * decodeLen;
    // subtle pulse on message
    bubbleGroup.setAttribute("transform", `translate(390,110) scale(${1 + 0.02*Math.sin(k*6.28)})`);
  }

  // 5) Receiver highlights
  if(p > cut4){
    caption.textContent = "Receiver: Decoding complete.";
    decodeArrow.style.strokeDashoffset = 0;
    receiver.classList.remove("ghost");
    receiver.classList.add("glow-decode");
    check.style.opacity = 1;
    bubbleGroup.setAttribute("transform", `translate(390,110) scale(1)`);
  }

  // progress bar
  bar.style.width = (p*100).toFixed(1) + "%";
}

/* ====== Play loop ====== */
function loop(ts){
  if(!playing){ return; }
  if(!t0){ t0 = ts; }
  const p = progress(ts);
  render(p);
  if(p >= 1){
    playing = false;
    playBtn.disabled = false;
    pauseBtn.disabled = true;
    caption.textContent = "Complete. Restart or change the message and play again.";
    return;
  }
  raf = requestAnimationFrame(loop);
}

/* ====== Controls ====== */
function play(){
  if(playing) return;
  playing = true;
  playBtn.disabled = true;
  pauseBtn.disabled = false;
  // resume from pause
  tPausedAt = 0;
  raf = requestAnimationFrame(loop);
}
function pause(){
  if(!playing) return;
  playing = false;
  pauseBtn.disabled = true;
  playBtn.disabled = false;
  // accumulate pause so we resume smoothly
  hold += performance.now() - (t0 + hold + (bar.offsetWidth/ bar.parentElement.offsetWidth)*totalBase/speedMul);
}
function restart(){
  cancelAnimationFrame(raf);
  playing = false;
  t0 = 0; hold = 0;
  playBtn.disabled = false;
  pauseBtn.disabled = true;

  // reset visuals
  sender.classList.add("ghost"); sender.classList.remove("glow-encode");
  receiver.classList.add("ghost"); receiver.classList.remove("glow-decode");
  encodeLabel.style.opacity = 0; decodeLabel.style.opacity = 0;
  encodeArrow.style.strokeDashoffset = encodeLen;
  decodeArrow.style.strokeDashoffset = decodeLen;
  bubbleGroup.style.opacity = 0; bubbleGroup.classList.remove("glow-message");
  noise.querySelectorAll("path").forEach(p=>p.style.opacity = 0);
  check.style.opacity = 0;
  bar.style.width = "0%";
  caption.textContent = "Ready.";
}

playBtn.addEventListener("click", play);
pauseBtn.addEventListener("click", ()=>{ pause(); caption.textContent="Paused."; });
restartBtn.addEventListener("click", restart);

speed.addEventListener("input", ()=>{
  speedMul = parseFloat(speed.value);
  speedVal.textContent = speedMul.toFixed(1) + "×";
});

msgInput.addEventListener("input", ()=>{
  bubbleText.textContent = msgInput.value.trim() || "Hello";
});

/* Initial render */
restart();
</script>
</body>
</html>
